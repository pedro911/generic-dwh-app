<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::body},'stats')}">
<head>
    <meta charset="UTF-8">
    <title>Stats</title>
</head>
<body>
<main role="main" class="container">
    <div class="jumbotron">
        <h3>Results of performance tests to be implemented...</h3>
        <p th:each="qt: ${queryTimes}">
            <a th:text="${qt.getQueryTimeMs()}"></a>
            <a th:text="${qt.getDbModel().getDbName()}"></a>
            <a th:text="${qt.getQueryString().getRefObjRatios()}"></a>
            <a th:text="${qt.getQueryExecDate()}"></a>

        </p>
        <canvas id="graph_smallDBs"></canvas>
        <canvas id="graph_1gbDBs"></canvas>
        <canvas id="graph_10gblDBs"></canvas>
    </div>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"
        integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous"></script>
<script th:src="@{/resources/js/graph.js}"></script>
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    //get data from objects and put on graph
    var dimensionsids = [1];
    /*[# th:each="dimension : ${dimensions}"]*/
    dimensionsids.push("[(${dimension.id})]");
    /*[/]*/
    console.log(dimensionsids);

    var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    var color = Chart.helpers.color;
    var graph_smallDBs = {
        labels: [
            /*[# th:each="o : ${smallLabels}" ]*/
            /*[[${ o[0] }]]*/,
            /*[/]*/
        ],
        datasets: [
            {
                label: 'TPC-H Std',
                backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                borderColor: window.chartColors.red,
                borderWidth: 1,
                data: dimensionsids
            },
            {
                label: 'Generic DWH',
                backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
                borderColor: window.chartColors.blue,
                borderWidth: 1,
                data: [
                    3,
                    2,
                    1,
                    3,
                    2
                ]},
            {
                label: 'Star Schema',
                backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
                borderColor: window.chartColors.orange,
                borderWidth: 1,
                data: [
                    /*[# th:each="o : ${smallStarTime}" ]*/
                    /*[[${ o[0] }]]*/,
                    /*[/]*/
                ]},
            {
                label: 'Snowflake Schema',
                backgroundColor: color(window.chartColors.purple).alpha(0.5).rgbString(),
                borderColor: window.chartColors.purple,
                borderWidth: 1,
                data: [
                    1.5,
                    7.6,
                    6.5,
                    2.4,
                    1.8
                ]}
        ]
    };

    var graph_1gbDBs = {
        labels: ['Q11', 'Q22', 'Q33', 'Q44', 'Q55'],
        datasets: [
            {
                label: 'Generic DWH DYN',
                backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                borderColor: window.chartColors.red,
                borderWidth: 1,
                data: dimensionsids
            },
            {
                label: 'Generic DWH NCB',
                backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
                borderColor: window.chartColors.blue,
                borderWidth: 1,
                data: [
                    3,
                    2,
                    1,
                    3,
                    2
                ]},
            {
                label: 'Star Schema aa',
                backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
                borderColor: window.chartColors.orange,
                borderWidth: 1,
                data: [
                    2,
                    7,
                    5,
                    0.7,
                    0.4
                ]},
            {
                label: 'Snowflake Schema bb',
                backgroundColor: color(window.chartColors.purple).alpha(0.5).rgbString(),
                borderColor: window.chartColors.purple,
                borderWidth: 1,
                data: [
                    1.5,
                    7.6,
                    6.5,
                    2.4,
                    1.8
                ]}
        ]
    };

    window.onload = function() {
        var ctx_graph_smallDBs = document.getElementById('graph_smallDBs').getContext('2d');
        window.myBar = new Chart(ctx_graph_smallDBs, {
            type: 'bar',
            data: graph_smallDBs,
            options: {
                responsive: true,
                legend: {
                    position: 'top'
                },
                title: {
                    display: true,
                    text: 'Query Average Time Performance from Small DBs'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Query'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        ticks: {
                            beginAtZero: true   // minimum value will be 0.
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Time (ms)'
                        }
                    }]
                }
            }
        });

        var ctx_graph_1gbDBs = document.getElementById('graph_1gbDBs').getContext('2d');
        window.myBar = new Chart(ctx_graph_1gbDBs, {
            type: 'bar',
            data: graph_1gbDBs,
            options: {
                responsive: true,
                legend: {
                    position: 'top'
                },
                title: {
                    display: true,
                    text: 'Query Average Time Performance from 1 GB DBs'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Query'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        ticks: {
                            beginAtZero: true   // minimum value will be 0.
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Time (ms)'
                        }
                    }]
                }
            }
        });

    };

    var colorNames = Object.keys(window.chartColors);
    /*]]>*/
</script>
</body>
</html>